<html>
	<body>
		<script type="module">
			const transport = new WebTransport(`https://${location.hostname}:8642`, {
				serverCertificateHashes: [
					{
						algorithm: "sha-256",
						value: new Uint8Array([
							56, 97, 15, 182, 61, 105, 16, 42, 33, 220, 26, 255, 229, 48, 223,
							113, 175, 76, 23, 119, 166, 25, 194, 31, 95, 87, 40, 95, 71, 248,
							64, 0,
						]),
					},
				],
			});

			await transport.ready;

			const writer = (await transport.createUnidirectionalStream()).getWriter();

			const CHUNK_SIZE = 4;
			while (true) {
				await writer.ready;
				await writer.write(new Uint8Array(CHUNK_SIZE));
				console.log(
					`sent ${CHUNK_SIZE} bytes, desiredSize: ${writer.desiredSize}`
				);
				await scheduler.yield(); //prevent firefox android from killing the script
			}
		</script>
	</body>
</html>
